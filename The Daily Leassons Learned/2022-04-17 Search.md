# 2022-04-17 Search
## 검색어 분석을 통한 상품 정렬 개선 by  MUSINSA tech
source) [검색어 분석을 통한 상품 정렬 개선 | MUSINSA tech](https://medium.com/musinsa-tech/%EA%B2%80%EC%83%89%EC%96%B4-%EB%B6%84%EC%84%9D%EC%9D%84-%ED%86%B5%ED%95%9C-%EC%83%81%ED%92%88-%EC%A0%95%EB%A0%AC-%EA%B0%9C%EC%84%A0-b92ded2923c3)
* 고객의 의도를 더 잘 이해하는 Elasticsearch 기반 검색 모델 만들기
* 무신사의 데이터를 보면..
	* 검색 이용자의 구매 전환율을 미이용자에 비해 4배 높음
	* 검색 결과에서 원하는 상품을 찾지 못한 고객은 50%의 확률로 이탈
* 기존 - 상품 검색 시 추천순 정렬
	* page view, 구매 이력, 후기 등 데이터를 색인 및 분석하여 상품 scoring
	* SRP(search results page)에 고객의 의도와는 다르지만 인기도 높은 상품을 먼저 추천하게 됨 (e.g. 레이스 양말을 찾는 고객에게 부츠를 추천)
* 개선 방향 - 검색 키워드 (브랜드 or 카테고리) 들어 맞는 상품 상위 노출
	* 검색어와 상품 색인 필드의 단어 간 확률적 연관 관계
	* 적합도 = 필드별 중요도 x 필드별 유사도
	* 필드별 중요도 : 특정 색인 필드를 얼마나 중시하는가에 대한 개념으로, 태그 필드보다 카테고리 필드에서 검색어가 매칭될 때 해당 상품이 더 부스팅 되도록 설정
	* 필드별 유사도 : 검색어와 특정 색인 필드 단어 간 vector 유사도 사용 (i.e. ‘무신사 스탠다드’는 ‘무신사’ 보다 ‘무신사 스탠다드’와의 유사도가 더 높게 계산)
* 개선 방향을 반영한 검색 시나리오
	* 브랜드 적합도가 가장 높은 상품이 그 이외의 상품보다 상위 노출
	* 브랜드가 동일한 상품의 경우, 카테고리 적합도가 높은 순으로 노출
* 시스템 구현을 위한 세부 절차
	* Elasticsearch의 function score query 통해 스코어링 모델 구현
		* 검색어와 색인 필드 단어 간의 일치 여부 점수화
		* 검색엔진 점수와 사용자가 생성한 적합도 점수, 인기도 점수 결합
	* 데이터 전처리 : 상품 랭킹 데이터, 적합도 적용 대상 필드
	* 검색엔진 커리 작성
		* 기존 여러 색인 필드 항목을 multi match query 통해 하나의 필드처럼 만들어 검색
		* Function score query로 개선 : (1) query 부분에는 기존의 검색 조건을 포함한 multi match query를 사용 (2) functions 부분에서는 스코어링하고 싶은 요소를 추가하여 상품 정렬을 변경
	* Elasticsearch에 적용할 분석기 구현
### Impressions
* 구체적인 의미는 이해하지 못했지만, Modeling 관련 Approach에 대해서도 전반적인 요소를 파악할 수 있었다. (형태소 분석, 유사도 알고리즘, 가중치 조합 등) 향후에 모델링 관련 Practice를 다시 모아 보아도 좋을 듯!
* 시스템 Architecture도 마찬가지-